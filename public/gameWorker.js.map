{"version":3,"sources":["webpack:///webpack/bootstrap d93414055a68a80ef3bd","webpack:///./workers/gameWorker.js"],"names":["gameWorker","GameWorker","constructor","eventBus","bus","queue","stepIndicator","getUserID","data","userID","figureType","detectFigureByUserID","request","func","winOrLose","win","finishArray","field","result","findMaxFiguresCount","countFigure","stepEnable","array","fieldSize","length","x","z","reqArray","i","j","Math","abs","coord","push","arrayAfterStep","startArray","game","maxX","arrayOfField","gamers","countPlayers","fullStep","step","response","shift","src","dst","figureForPaint","vector","clone","figure","color","self","postMessage","setTimeout","bind","max","maxI","onmessage","workerRequest","workerResponse","code","console","log","undefined"],"mappings":"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","file":"gameWorker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 131);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d93414055a68a80ef3bd","'use strict';\n\nconst gameWorker = new class GameWorker {\n\tconstructor(eventBus) {\n\t\tthis.bus = eventBus;\n\t\tthis.queue = [];\n\t\tthis.stepIndicator = true;\n\t}\n\n\tgetUserID(data) {\n\t\tthis.userID = data.userID;\n\t\tthis.figureType = this.detectFigureByUserID(this.userID);\n\t\tconst request = {\n\t\t\tfunc: 'figureType',\n\t\t\tfigureType: this.figureType\n\t\t};\n\n\t\treturn request;\n\t}\n\n\twinOrLose(data) {\n\t\tlet win = false;\n\t\tconst finishArray = data.field.field;\n\t\tthis.result = this.findMaxFiguresCount(this.countFigure(finishArray));\n\t\tif (this.result === this.figureType) { win = true; }\n\t\tlet request = {\n\t\t\tfunc: 'winnerOrLooser',\n\t\t\twin: win\n\t\t};\n\n\t\treturn request;\n\t}\n\n\tstepEnable(data) {\n\t\tlet array = data.array;\n\t\tconst fieldSize = array.length;\n\t\tlet x = data.x;\n\t\tlet z = data.z;\n\t\tlet reqArray = [];\n\t\tfor (let i = 0; i < fieldSize; i++) {\n\t\t\tfor (let j = 0; j < fieldSize; j++) {\n\t\t\t\tif (!(Math.abs(i - x) >= 3 ||\n\t\t\t\t\t\tMath.abs(j - z) >= 3 ||\n\t\t\t\t\t\tarray[i][j] !== 0 )) {\n\t\t\t\t\tlet coord = {\n\t\t\t\t\t\tx: i,\n\t\t\t\t\t\tz: j\n\t\t\t\t\t};\n\t\t\t\t\treqArray.push(coord);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst request = {\n\t\t\tfunc: 'stepEnable',\n\t\t\tarrayAfterStep: reqArray\n\t\t};\n\n\t\treturn request;\n\t}\n\n\tstartArray(data) {\n\t\tthis.fieldSize = data.game.field.maxX;\n\t\tthis.arrayOfField = data.game.field.field;\n\t\tthis.gamers = data.game.gamers;\n\t\tthis.countPlayers = this.gamers.length;\n\n\t\tthis.fullStep();\n\t}\n\n\tstep(data) {\n\t\tthis.queue.push(data);\n\t}\n\n\tfullStep() {\n\t\tif (typeof this.queue !== 'undefined' && this.queue !== null &&\n\t\t\tthis.queue.length > 0 && this.stepIndicator\n\t\t) {\n\t\t\tthis.stepIndicator = false;\n\t\t\tconst response = this.queue.shift();\n\t\t\tconst src = response.step.src;\n\t\t\tconst dst = response.step.dst;\n\t\t\tlet figureForPaint = [];\n\t\t\tlet step = {\n\t\t\t\tsrc: response.step.src,\n\t\t\t\tdst: response.step.dst\n\t\t\t};\n\t\t\tlet vector = {\n\t\t\t\tx: 0,\n\t\t\t\tz: 0,\n\t\t\t};\n\t\t\tlet clone = false;\n\n\t\t\tvector.x = dst.x - src.x;\n\t\t\tvector.z = dst.z - src.z;\n\n\t\t\tif (Math.abs(dst.x - src.x) <= 1 && Math.abs(dst.z - src.z) <= 1) {\n\t\t\t\tclone = true;\n\t\t\t\tthis.arrayOfField[dst.x][dst.z] = this.arrayOfField[src.x][src.z];\n\t\t\t} else {\n\t\t\t\tthis.arrayOfField[dst.x][dst.z] = this.arrayOfField[src.x][src.z];\n\t\t\t\tthis.arrayOfField[src.x][src.z] = 0;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < this.fieldSize; i++) {\n\t\t\t\tfor (let j = 0; j < this.fieldSize; j++) {\n\t\t\t\t\t// Первые два условия проверяют, что перебираемая в цикле клетка находится вплотную к заданной.\n\t\t\t\t\tif (Math.abs(i - dst.x) <= 1 &&\n\t\t\t\t\t\tMath.abs(j - dst.z) <= 1) {\n\t\t\t\t\t\t// Затем идет проверка, что на этой клетке есть фигура и что она отлична от той, которая совершила ход.\n\t\t\t\t\t\tif (this.arrayOfField[i][j] !== 0 &&\n\t\t\t\t\t\t\tthis.arrayOfField[i][j] !== this.arrayOfField[dst.x][dst.z]) {\n\t\t\t\t\t\t\t// Если там стоит вражеская фигура, то ее цвет меняется на цвет той, которая совершила ход.\n\t\t\t\t\t\t\tlet figure = {\n\t\t\t\t\t\t\t\tx: i,\n\t\t\t\t\t\t\t\tz: j,\n\t\t\t\t\t\t\t\tcolor: this.arrayOfField[dst.x][dst.z]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tfigureForPaint.push(figure);\n\t\t\t\t\t\t\t// И затем в массив клеток вносятся соответствующие изменения по фигурам.\n\t\t\t\t\t\t\tthis.arrayOfField[i][j] = this.arrayOfField[dst.x][dst.z];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst request = {\n\t\t\t\tfunc: 'coordinatesForStep',\n\t\t\t\tvector: vector,\n\t\t\t\tclone: clone,\n\t\t\t\tstep: step,\n\t\t\t\tfigureForPaint: figureForPaint\n\t\t\t};\n\n\t\t\tthis.stepIndicator = true;\n\n\t\t\tself.postMessage(request);\n\t\t}\n\n\t\tsetTimeout(this.fullStep.bind(this), 1000);\n\t}\n\n\tcountFigure(array) {\n\t\tconst countFigure = [];\n\t\tfor (let i = 0; i < this.countPlayers; i++) {\n\t\t\tcountFigure[i] = 0;\n\t\t}\n\t\tfor (let i = 0; i < this.fieldSize; i++) {\n\t\t\tfor (let j = 0; j < this.fieldSize; j++) {\n\t\t\t\tif (array[i][j] > 0) {\n\t\t\t\t\tcountFigure[array[i][j] - 1]++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn countFigure;\n\t}\n\n\tfindMaxFiguresCount(array) {\n\t\tlet max = 0;\n\t\tlet maxI = 0;\n\t\tfor (let i = 0; i < array.length; i++) {\n\t\t\tif (array[i] > max) {\n\t\t\t\tmax = array[i];\n\t\t\t\tmaxI = i;\n\t\t\t}\n\t\t}\n\t\treturn maxI;\n\t}\n\n\tdetectFigureByUserID(userID) {\n\t\tfor (let i = 0; i < this.gamers.length; i++) {\n\t\t\tif (this.gamers[i].userID === userID) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t}\n};\n\n\nself.onmessage = (workerRequest) => {\n\tlet data = workerRequest.data;\n\tlet workerResponse;\n\tswitch (`${data.code}`) {\n\t\tcase '204':\n\t\t\tworkerResponse = gameWorker.winOrLose(data);\n\t\t\tbreak;\n\t\tcase '215':\n\t\t\tworkerResponse = gameWorker.stepEnable(data);\n\t\t\tbreak;\n\t\tcase '200':\n\t\t\tgameWorker.startArray(data);\n\t\t\tbreak;\n\t\tcase '112':\n\t\t\tworkerResponse = gameWorker.getUserID(data);\n\t\t\tbreak;\n\t\tcase '201':\n\t\t\tgameWorker.step(data);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tconsole.log('Error');\n\t}\n\tif (workerResponse !== undefined)\n\t\tself.postMessage(workerResponse);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./workers/gameWorker.js"],"sourceRoot":""}